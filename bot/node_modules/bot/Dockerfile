# # Use a pre-built Chromium image or faster mirror
# FROM node:18-slim

# # Switch to a faster mirror and install dependencies
# RUN echo "deb http://ftp.us.debian.org/debian/ bookworm main" > /etc/apt/sources.list \
#   && apt-get update -q && apt-get install -y --no-install-recommends tini chromium \
#   && rm -rf /var/lib/apt/lists/*

# WORKDIR /app

# # Copy package.json and install node dependencies
# COPY package.json .
# RUN npm install

# # Copy the rest of the application code
# COPY . .

# # Set tini as the entrypoint and npm as the default command
# ENTRYPOINT ["tini", "--"]
# CMD ["npm", "start"]

# # Expose port 8000
# EXPOSE 8000



FROM node:16-alpine3.16

ENV LANG="C.UTF-8" PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=true

RUN apk update && \
    apk add --no-cache zlib-dev udev nss ca-certificates chromium && \
    adduser -h /home/bot -D -u 10086 bot && \
    yarn cache clean && \
    rm -rf /tmp/* /etc/apk/* /var/cache/apk/* /usr/share/man

WORKDIR /home/bot

COPY ./*.json .

RUN npm install

COPY . .

USER bot
EXPOSE 9000

CMD ["node", "/bot/index.js"]